<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connect | Webview</title>
    <link rel="icon" href="data:;base64,=">
  </head>

  <body>
    <div>
      <h1 id="network-status"></h1>
      <h1 id="operator-status"></h1>
      <input type="button" value="Call" id="button-call" />
      <br>
      <p id="resource-pool"></p>
      <p><a href="https://github.com/hapi-robo/connect-webview/">GitHub</a></p>
    </div>

    <script type="text/javascript">
      const RESOURCE_POOL_ID = 'FV4ICw4bxD7qRa92qGA1';
      const operatorStatus = document.querySelector('#operator-status');
      const networkStatus = document.querySelector('#network-status');

      // Button event listener
      const buttonCall = document.querySelector('#button-call');
      buttonCall.addEventListener('click', () => {
        // Check if this device is using Connect
        if (typeof connect !== "undefined") {
          connect.call(RESOURCE_POOL_ID);
        } else {
          alert("Sorry, this will only work on Connect");
        }
      });

      // Operator status listener
      function onOperatorStatusChange(availableMembers) {
        if (availableMembers > 0) {
          operatorStatus.innerHTML = `Available (${availableMembers})`;
        } else {
          operatorStatus.innerHTML = 'Unavailable';
        }
      }

      window.addEventListener('load', () => {
        document.querySelector('#resource-pool').innerHTML = `${RESOURCE_POOL_ID}`;
        if (typeof connect !== "undefined") {
          // Register status listener
          connect.addStatusListener('onOperatorStatusChange', RESOURCE_POOL_ID);
        }
      });

      window.addEventListener('offline', () => {
        console.log('Offline');
        networkStatus.innerHTML = 'OFFLINE';
      });

      window.addEventListener('online', () => {
        console.log('Online');
        networkStatus.innerHTML = 'ONLINE';
      });
    </script> 
  </body>
</html>
